<html layout:decorate="~{layout/layout.html}">
<body>
<section class="article-modify-section my-10" layout:fragment="content">
  <div class="container mx-auto">
    <form th:action method="POST" enctype="multipart/form-data" onsubmit="ModifyForm__submit(this); return false;">
      <fieldset class="fieldset">
        <legend class="fieldset-legend">제목</legend>
        <input
            class="input"
            type="text"
            placeholder="제목을 입력해주세요."
            title="input title"
            name="title"
            th:value="${article.title}"
        />
      </fieldset>
      <fieldset class="fieldset">
        <legend class="fieldset-legend">내용</legend>
        <textarea class="textarea h-24" placeholder="내용을 입력해주세요." name="content"
                  th:text="${article.content}"></textarea>
      </fieldset>
      <!-- Article Images -->
      <h2 class="text-2xl font-bold">이미지 파일 수정</h2>

      <th:block th:with="mapSize=${article.extra.genFileMap.size()}">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-8">
          <th:block th:each="i : ${#numbers.sequence(1, mapSize)}"
                    th:with="genFile=${article.extra.genFileMap.get('common\_\_inBody\_\_' + i)}">
            <div class="flex flex-col gap-y-3">
              <th:block th:if="${genFile != null}">
                <div class="text-[14px] flex justify-between">
                  <span th:text="|${i}번 이미지|"></span>
                  <label class="badge badge-primary cursor-pointer" type="checkbox" value="" th:name="|delete___common\_\_inBody\_\_${i}|">
                    <span>이미지 삭제</span>
                  </label>
                </div>
                <div class="flex flex-col gap-y-2 h-100">
                  <a th:href="${genFile.url}" target="_blank" class="rounded-lg overflow-hidden">
                    <img th:src="${genFile.url}"
                         th:alt="|이미지${i}|"
                         class="w-full h-full object-cover">
                  </a>
                  <input type="file" th:name="|common\_\_inBody\_\_${i}|" class="file-input" accept="image/jpeg, image/jpg, image/png, image/gif, image/webp">
                </div>
              </th:block>
            </div>
          </th:block>
        </div>
      </th:block>
      <div class="mt-2">
        <button type="submit" class="btn btn-neutral">수정</button>
      </div>
    </form>
  </div>
  <script>
    function ModifyForm__submit(form) {
      form.title.value = form.title.value.trim();
      if(form.title.value.length === 0) {
        alert("제목을 입력해주세요.");
        form.title.focus();
        return;
      }

      form.content.value = form.content.value.trim();
      if(form.content.value.length === 0) {
        alert("내용을 입력해주세요.");
        form.content.focus();
        return;
      }

      // 모든 유효성 검사를 통과하면 폼 제출
      form.submit();
    }
  </script>
</section>
</body>
</html>



